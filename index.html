<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–º–µ–π–∫–∞ —Å Rickroll –∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–æ–º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0d1b2a 0%, #1b263b 100%);
            color: #e0e1dd;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 1000px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #c9c9c9;
        }
        
        .main-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            width: 100%;
            max-width: 1400px;
        }
        
        .left-panel {
            flex: 1;
            min-width: 300px;
            max-width: 400px;
        }
        
        .right-panel {
            flex: 2;
            min-width: 300px;
            max-width: 600px;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        #gameCanvas {
            background-color: #0a1929;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid #4a4e69;
        }
        
        .video-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        
        #videoWrapper {
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            background-color: #000;
            display: none;
        }
        
        #youtubePlayer {
            width: 100%;
            height: 300px;
        }
        
        .controls {
            background-color: #1b263b;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            width: 100%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid #2d3a52;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stat-box {
            background-color: #0d1b2a;
            padding: 15px;
            border-radius: 8px;
            flex: 1;
            min-width: 120px;
            text-align: center;
            border: 1px solid #2d3a52;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #4ecdc4;
            margin-top: 5px;
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(to right, #4a4e69, #22223b);
            color: white;
            border: none;
            padding: 14px 28px;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to right, #565b7a, #2a2a48);
        }
        
        button:active:not(:disabled) {
            transform: translateY(1px);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        #startBtn {
            background: linear-gradient(to right, #4ecdc4, #44a08d);
        }
        
        #startBtn:hover:not(:disabled) {
            background: linear-gradient(to right, #5adfd6, #4db09d);
        }
        
        #restartBtn {
            background: linear-gradient(to right, #ff6b6b, #ee5a52);
        }
        
        #restartBtn:hover:not(:disabled) {
            background: linear-gradient(to right, #ff7b7b, #f06a62);
        }
        
        #leaderboardBtn {
            background: linear-gradient(to right, #ffd166, #ffb347);
            color: #333;
        }
        
        #leaderboardBtn:hover:not(:disabled) {
            background: linear-gradient(to right, #ffe176, #ffc357);
        }
        
        .leaderboard-container {
            background-color: #1b263b;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            width: 100%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid #2d3a52;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .leaderboard-container h3 {
            color: #ffd166;
            margin-bottom: 15px;
            font-size: 1.5rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .leaderboard-table th {
            background-color: #0d1b2a;
            padding: 12px;
            text-align: left;
            color: #4ecdc4;
            border-bottom: 2px solid #2d3a52;
        }
        
        .leaderboard-table td {
            padding: 12px;
            border-bottom: 1px solid #2d3a52;
        }
        
        .leaderboard-table tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .rank-cell {
            font-weight: bold;
            text-align: center;
            width: 50px;
        }
        
        .player-name {
            font-weight: bold;
            color: #e0e1dd;
        }
        
        .player-score {
            color: #ff6b6b;
            font-weight: bold;
            text-align: right;
        }
        
        .player-date {
            color: #8d99ae;
            font-size: 0.9rem;
            text-align: center;
        }
        
        .medal-gold {
            color: gold;
            font-size: 1.2rem;
        }
        
        .medal-silver {
            color: silver;
            font-size: 1.2rem;
        }
        
        .medal-bronze {
            color: #cd7f32;
            font-size: 1.2rem;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #8d99ae;
        }
        
        .instructions {
            background-color: #1b263b;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            width: 100%;
            max-width: 1000px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid #2d3a52;
        }
        
        .instructions h3 {
            color: #4ecdc4;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .instructions ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .instructions p {
            font-style: italic;
            color: #a9b2c3;
            text-align: center;
            padding-top: 10px;
            border-top: 1px solid #2d3a52;
        }
        
        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .game-over-content {
            background: linear-gradient(135deg, #1b263b, #0d1b2a);
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7);
            border: 2px solid #4a4e69;
        }
        
        .game-over h2 {
            color: #ff6b6b;
            font-size: 2.8rem;
            margin-bottom: 20px;
        }
        
        .game-over p {
            font-size: 1.3rem;
            margin-bottom: 30px;
            color: #e0e1dd;
        }
        
        .player-name-input {
            margin: 20px 0;
            text-align: center;
        }
        
        .player-name-input input {
            background-color: #0d1b2a;
            border: 2px solid #4a4e69;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1.1rem;
            width: 100%;
            max-width: 300px;
            text-align: center;
        }
        
        .player-name-input input:focus {
            outline: none;
            border-color: #4ecdc4;
        }
        
        .mobile-controls {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
            max-width: 300px;
        }
        
        .mobile-controls button {
            padding: 20px;
            font-size: 1.5rem;
        }
        
        #upBtn { grid-column: 2; grid-row: 1; }
        #leftBtn { grid-column: 1; grid-row: 2; }
        #downBtn { grid-column: 2; grid-row: 2; }
        #rightBtn { grid-column: 3; grid-row: 2; }
        
        @media (max-width: 1100px) {
            .main-container {
                flex-direction: column;
                align-items: center;
            }
            
            .left-panel, .right-panel {
                max-width: 100%;
                width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            #gameCanvas {
                width: 95vw;
                height: auto;
            }
            
            .mobile-controls {
                display: grid;
            }
            
            .video-container {
                width: 95vw;
            }
            
            #youtubePlayer {
                height: 250px;
            }
            
            .leaderboard-container {
                max-height: 400px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .stat-box {
                min-width: 100px;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
            
            button {
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            .leaderboard-table th, .leaderboard-table td {
                padding: 8px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>–ó–º–µ–π–∫–∞ —Å Rickroll –∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–æ–º</h1>
        <p class="subtitle">–°—ã–≥—Ä–∞–π—Ç–µ –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é –∑–º–µ–π–∫—É, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –Ω–∞—Å–ª–∞–¥–∏—Ç–µ—Å—å Rickroll –ø—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–µ!</p>
    </div>
    
    <div class="main-container">
        <div class="left-panel">
            <div class="game-area">
                <canvas id="gameCanvas" width="400" height="400"></canvas>
                
                <div class="mobile-controls">
                    <button id="upBtn">‚Üë</button>
                    <button id="leftBtn">‚Üê</button>
                    <button id="downBtn">‚Üì</button>
                    <button id="rightBtn">‚Üí</button>
                </div>
                
                <div class="video-container">
                    <div id="videoWrapper">
                        <div id="youtubePlayer"></div>
                    </div>
                    
                    <div class="controls">
                        <div class="stats">
                            <div class="stat-box">
                                <div>–°—á—ë—Ç</div>
                                <div id="score" class="stat-value">0</div>
                            </div>
                            <div class="stat-box">
                                <div>–†–µ–∫–æ—Ä–¥</div>
                                <div id="highScore" class="stat-value">0</div>
                            </div>
                            <div class="stat-box">
                                <div>–°–∫–æ—Ä–æ—Å—Ç—å</div>
                                <div id="speed" class="stat-value">1</div>
                            </div>
                        </div>
                        
                        <div class="buttons">
                            <button id="startBtn">
                                <span>‚ñ∂</span> –°—Ç–∞—Ä—Ç
                            </button>
                            <button id="restartBtn">
                                <span>‚Üª</span> –†–µ—Å—Ç–∞—Ä—Ç
                            </button>
                            <button id="pauseBtn">
                                <span>‚è∏</span> –ü–∞—É–∑–∞
                            </button>
                            <button id="leaderboardBtn">
                                <span>üèÜ</span> –õ–∏–¥–µ—Ä—ã
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="right-panel">
            <div class="leaderboard-container">
                <h3><span>üèÜ</span> –¢–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤ <span>üèÜ</span></h3>
                <div id="leaderboardContent" class="loading">
                    –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤...
                </div>
            </div>
        </div>
    </div>
    
    <div class="instructions">
        <h3>–ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</h3>
        <ul>
            <li>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∑–º–µ–π–∫–æ–π —Å –ø–æ–º–æ—â—å—é —Å—Ç—Ä–µ–ª–æ–∫ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –∏–ª–∏ –∫–Ω–æ–ø–æ–∫ –Ω–∞ —ç–∫—Ä–∞–Ω–µ (–Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö)</li>
            <li>–°–æ–±–∏—Ä–∞–π—Ç–µ –∫—Ä–∞—Å–Ω—É—é –µ–¥—É, —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å —Å—á—ë—Ç –∏ –¥–ª–∏–Ω—É –∑–º–µ–π–∫–∏</li>
            <li>–ò–∑–±–µ–≥–∞–π—Ç–µ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π —Å–æ —Å—Ç–µ–Ω–∞–º–∏ –∏ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º —Ç–µ–ª–æ–º</li>
            <li>–ö–∞–∂–¥—ã–µ 5 –æ—á–∫–æ–≤ —Å–∫–æ—Ä–æ—Å—Ç—å –∑–º–µ–π–∫–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è</li>
            <li>–ü–æ—Å–ª–µ –ø—Ä–æ–∏–≥—Ä—ã—à–∞ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ—ë –∏–º—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ –ª–∏–¥–µ—Ä–æ–≤</li>
            <li>–ü—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∫–ª–∏–ø Rick Astley - Never Gonna Give You Up</li>
        </ul>
        <p>–ü–æ—Å–ª–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–ª–∏–ø–∞ –Ω–∞–∂–º–∏—Ç–µ "–†–µ—Å—Ç–∞—Ä—Ç", —á—Ç–æ–±—ã —Å—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞!</p>
    </div>
    
    <div class="game-over" id="gameOverScreen">
        <div class="game-over-content">
            <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
            <p>–í–∞—à —Å—á—ë—Ç: <span id="finalScore">0</span></p>
            
            <div class="player-name-input">
                <input type="text" id="playerName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" maxlength="20" value="–ò–≥—Ä–æ–∫">
            </div>
            
            <p>–°–µ–π—á–∞—Å –Ω–∞—á–Ω—ë—Ç—Å—è Rickroll!</p>
            <div class="buttons">
                <button id="saveScoreBtn">
                    <span>üíæ</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </button>
                <button id="closeVideoBtn">
                    <span>‚úï</span> –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–µ–æ
                </button>
                <button id="restartFromOverBtn">
                    <span>‚Üª</span> –ù–æ–≤–∞—è –∏–≥—Ä–∞
                </button>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        const supabaseUrl = 'https://lzxssxdhcruwtswwezrj.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx6eHNzeGRoY3J1d3Rzd3dlenJqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI2NjkwNDcsImV4cCI6MjA1ODI0NTA0N30.WJp_iHwkNdFFfmtx-12vpg_y-6w8s-R';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–≥—Ä—ã
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('highScore');
        const speedElement = document.getElementById('speed');
        const finalScoreElement = document.getElementById('finalScore');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const videoWrapper = document.getElementById('videoWrapper');
        const leaderboardContent = document.getElementById('leaderboardContent');
        const playerNameInput = document.getElementById('playerName');
        
        // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const leaderboardBtn = document.getElementById('leaderboardBtn');
        const closeVideoBtn = document.getElementById('closeVideoBtn');
        const restartFromOverBtn = document.getElementById('restartFromOverBtn');
        const saveScoreBtn = document.getElementById('saveScoreBtn');
        
        // –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        const upBtn = document.getElementById('upBtn');
        const downBtn = document.getElementById('downBtn');
        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');
        
        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä—ã
        const gridSize = 20;
        const gridWidth = canvas.width / gridSize;
        const gridHeight = canvas.height / gridSize;
        
        let snake = [];
        let food = {};
        let direction = 'right';
        let nextDirection = 'right';
        let gameSpeed = 150; // –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
        let gameInterval;
        let score = 0;
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        let gameRunning = false;
        let gamePaused = false;
        let gameStartTime = 0;
        let gameDuration = 0;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–º–µ–π–∫–∏
            snake = [
                {x: 5, y: 10},
                {x: 4, y: 10},
                {x: 3, y: 10}
            ];
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä–≤–æ–π –µ–¥—ã
            generateFood();
            
            // –°–±—Ä–æ—Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            direction = 'right';
            nextDirection = 'right';
            
            // –°–±—Ä–æ—Å —Å—á—ë—Ç–∞ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏
            score = 0;
            gameSpeed = 150;
            updateScore();
            updateSpeed();
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–∫–æ—Ä–¥–∞
            highScoreElement.textContent = highScore;
            
            // –°–∫—Ä—ã—Ç–∏–µ –≤–∏–¥–µ–æ
            videoWrapper.style.display = 'none';
            gameOverScreen.style.display = 'none';
            
            // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
            gameStartTime = Date.now();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤
            loadLeaderboard();
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –µ–¥—ã
        function generateFood() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ–±—ã –µ–¥–∞ –Ω–µ –ø–æ—è–≤–ª—è–ª–∞—Å—å –Ω–∞ –∑–º–µ–π–∫–µ
            let foodOnSnake;
            do {
                food = {
                    x: Math.floor(Math.random() * gridWidth),
                    y: Math.floor(Math.random() * gridHeight)
                };
                
                foodOnSnake = snake.some(segment => segment.x === food.x && segment.y === food.y);
            } while (foodOnSnake);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç–∞
        function updateScore() {
            scoreElement.textContent = score;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('snakeHighScore', highScore);
                highScoreElement.textContent = highScore;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–µ 5 –æ—á–∫–æ–≤
            if (score > 0 && score % 5 === 0) {
                gameSpeed = Math.max(50, 150 - Math.floor(score / 5) * 10);
                updateSpeed();
                
                // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ —Å –Ω–æ–≤–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é
                if (gameRunning && !gamePaused) {
                    clearInterval(gameInterval);
                    gameInterval = setInterval(gameLoop, gameSpeed);
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏
        function updateSpeed() {
            // –í—ã—á–∏—Å–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ—Ç 1 –¥–æ 10
            const speedLevel = Math.min(10, Math.max(1, Math.floor((150 - gameSpeed) / 10) + 1));
            speedElement.textContent = speedLevel;
        }
        
        // –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (gamePaused) return;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            direction = nextDirection;
            
            // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≥–æ–ª–æ–≤—ã –∑–º–µ–π–∫–∏
            const head = {...snake[0]};
            
            switch(direction) {
                case 'up': head.y--; break;
                case 'down': head.y++; break;
                case 'left': head.x--; break;
                case 'right': head.x++; break;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å–æ —Å—Ç–µ–Ω–∞–º–∏
            if (head.x < 0 || head.x >= gridWidth || head.y < 0 || head.y >= gridHeight) {
                gameOver();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å —Å–æ–±–æ–π
            if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                gameOver();
                return;
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –≥–æ–ª–æ–≤—ã
            snake.unshift(head);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å—ä–µ–ª–∞ –ª–∏ –∑–º–µ–π–∫–∞ –µ–¥—É
            if (head.x === food.x && head.y === food.y) {
                // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á—ë—Ç–∞
                score++;
                updateScore();
                
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π –µ–¥—ã
                generateFood();
            } else {
                // –£–¥–∞–ª–µ–Ω–∏–µ —Ö–≤–æ—Å—Ç–∞, –µ—Å–ª–∏ –µ–¥–∞ –Ω–µ —Å—ä–µ–¥–µ–Ω–∞
                snake.pop();
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä—ã
            drawGame();
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä—ã
        function drawGame() {
            // –û—á–∏—Å—Ç–∫–∞ —Ö–æ–ª—Å—Ç–∞
            ctx.fillStyle = '#0a1929';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏
            ctx.strokeStyle = '#1b263b';
            ctx.lineWidth = 0.5;
            
            for (let x = 0; x < canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y < canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–º–µ–π–∫–∏
            snake.forEach((segment, index) => {
                // –ì–æ–ª–æ–≤–∞ –∑–º–µ–π–∫–∏
                if (index === 0) {
                    ctx.fillStyle = '#4ecdc4';
                    ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
                    
                    // –ì–ª–∞–∑–∞ –∑–º–µ–π–∫–∏
                    ctx.fillStyle = '#0a1929';
                    const eyeSize = gridSize / 5;
                    
                    // –ì–ª–∞–∑–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                    let leftEyeX, leftEyeY, rightEyeX, rightEyeY;
                    
                    switch(direction) {
                        case 'up':
                            leftEyeX = segment.x * gridSize + gridSize * 0.25;
                            leftEyeY = segment.y * gridSize + gridSize * 0.25;
                            rightEyeX = segment.x * gridSize + gridSize * 0.75 - eyeSize;
                            rightEyeY = segment.y * gridSize + gridSize * 0.25;
                            break;
                        case 'down':
                            leftEyeX = segment.x * gridSize + gridSize * 0.25;
                            leftEyeY = segment.y * gridSize + gridSize * 0.75 - eyeSize;
                            rightEyeX = segment.x * gridSize + gridSize * 0.75 - eyeSize;
                            rightEyeY = segment.y * gridSize + gridSize * 0.75 - eyeSize;
                            break;
                        case 'left':
                            leftEyeX = segment.x * gridSize + gridSize * 0.25;
                            leftEyeY = segment.y * gridSize + gridSize * 0.25;
                            rightEyeX = segment.x * gridSize + gridSize * 0.25;
                            rightEyeY = segment.y * gridSize + gridSize * 0.75 - eyeSize;
                            break;
                        case 'right':
                            leftEyeX = segment.x * gridSize + gridSize * 0.75 - eyeSize;
                            leftEyeY = segment.y * gridSize + gridSize * 0.25;
                            rightEyeX = segment.x * gridSize + gridSize * 0.75 - eyeSize;
                            rightEyeY = segment.y * gridSize + gridSize * 0.75 - eyeSize;
                            break;
                    }
                    
                    ctx.fillRect(leftEyeX, leftEyeY, eyeSize, eyeSize);
                    ctx.fillRect(rightEyeX, rightEyeY, eyeSize, eyeSize);
                } 
                // –¢–µ–ª–æ –∑–º–µ–π–∫–∏
                else {
                    // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–µ —Ç–µ–ª–æ –æ—Ç –≥–æ–ª–æ–≤—ã –∫ —Ö–≤–æ—Å—Ç—É
                    const colorValue = Math.max(100, 255 - index * 15);
                    ctx.fillStyle = `rgb(78, 205, 196, ${0.7 - index * 0.05})`;
                    ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
                    
                    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–≤–∞–¥—Ä–∞—Ç –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —á–µ—à—É–∏
                    ctx.fillStyle = `rgb(62, 180, 172, ${0.5 - index * 0.03})`;
                    const padding = gridSize / 5;
                    ctx.fillRect(
                        segment.x * gridSize + padding, 
                        segment.y * gridSize + padding, 
                        gridSize - padding * 2, 
                        gridSize - padding * 2
                    );
                }
            });
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –µ–¥—ã
            ctx.fillStyle = '#ff6b6b';
            ctx.beginPath();
            const centerX = food.x * gridSize + gridSize / 2;
            const centerY = food.y * gridSize + gridSize / 2;
            const radius = gridSize / 2 - 2;
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.fill();
            
            // –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è –µ–¥—ã
            ctx.shadowColor = '#ff6b6b';
            ctx.shadowBlur = 10;
            ctx.fill();
            ctx.shadowBlur = 0;
            
            // –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —á–∞—Å—Ç—å –µ–¥—ã
            ctx.fillStyle = '#ff9e9e';
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.6, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // –û–∫–æ–Ω—á–∞–Ω–∏–µ –∏–≥—Ä—ã
        function gameOver() {
            gameRunning = false;
            clearInterval(gameInterval);
            
            // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–≥—Ä—ã
            gameDuration = Math.floor((Date.now() - gameStartTime) / 1000);
            
            // –ü–æ–∫–∞–∑ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å—á—ë—Ç–∞
            finalScoreElement.textContent = score;
            
            // –ü–æ–∫–∞–∑ —ç–∫—Ä–∞–Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
            gameOverScreen.style.display = 'flex';
        }
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ Rickroll
        function playRickroll() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ
            videoWrapper.style.display = 'block';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º YouTube –≤–∏–¥–µ–æ
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º ID –≤–∏–¥–µ–æ Rick Astley - Never Gonna Give You Up
            const videoId = 'dQw4w9WgXcQ';
            
            // –°–æ–∑–¥–∞—ë–º iframe –¥–ª—è YouTube –ø–ª–µ–µ—Ä–∞
            const playerDiv = document.getElementById('youtubePlayer');
            playerDiv.innerHTML = `
                <iframe 
                    width="100%" 
                    height="100%" 
                    src="https://www.youtube.com/embed/${videoId}?autoplay=1&mute=0&controls=1&modestbranding=1&rel=0" 
                    title="Rick Astley - Never Gonna Give You Up" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            `;
        }
        
        // ==================== SUPABASE –§–£–ù–ö–¶–ò–ò ====================
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤
        async function loadLeaderboard() {
            leaderboardContent.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤...</div>';
            
            try {
                const { data, error } = await supabase
                    .from('snake_scores')
                    .select('*')
                    .order('score', { ascending: false })
                    .limit(10);
                
                if (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:', error);
                    leaderboardContent.innerHTML = '<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>';
                    return;
                }
                
                if (!data || data.length === 0) {
                    leaderboardContent.innerHTML = '<div class="loading">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</div>';
                    return;
                }
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
                let html = '<table class="leaderboard-table">';
                html += '<thead><tr><th class="rank-cell">#</th><th>–ò–≥—Ä–æ–∫</th><th class="player-score">–°—á—ë—Ç</th><th class="player-date">–î–∞—Ç–∞</th></tr></thead><tbody>';
                
                data.forEach((item, index) => {
                    let rankClass = '';
                    let rankSymbol = `${index + 1}.`;
                    
                    if (index === 0) {
                        rankClass = 'medal-gold';
                        rankSymbol = 'ü•á';
                    } else if (index === 1) {
                        rankClass = 'medal-silver';
                        rankSymbol = 'ü•à';
                    } else if (index === 2) {
                        rankClass = 'medal-bronze';
                        rankSymbol = 'ü•â';
                    }
                    
                    const date = new Date(item.created_at);
                    const formattedDate = `${date.getDate().toString().padStart(2, '0')}.${(date.getMonth() + 1).toString().padStart(2, '0')}.${date.getFullYear()}`;
                    
                    html += `
                        <tr>
                            <td class="rank-cell ${rankClass}">${rankSymbol}</td>
                            <td class="player-name">${item.player_name}</td>
                            <td class="player-score">${item.score}</td>
                            <td class="player-date">${formattedDate}</td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                leaderboardContent.innerHTML = html;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:', error);
                leaderboardContent.innerHTML = '<div class="loading">–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É</div>';
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã
        async function saveGameResult() {
            const playerName = playerNameInput.value.trim() || '–ò–≥—Ä–æ–∫';
            
            if (playerName === '') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            saveScoreBtn.innerHTML = '<span>‚è≥</span> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
            saveScoreBtn.disabled = true;
            
            try {
                const { data, error } = await supabase
                    .from('snake_scores')
                    .insert([{
                        player_name: playerName.substring(0, 20),
                        score: score,
                        snake_length: snake.length,
                        game_duration: gameDuration,
                        level: Math.min(10, Math.max(1, Math.floor((150 - gameSpeed) / 10) + 1))
                    }])
                    .select();
                
                if (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', error);
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
                    return;
                }
                
                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', data);
                alert(`–†–µ–∑—É–ª—å—Ç–∞—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω! –í—ã –∑–∞–Ω—è–ª–∏ –º–µ—Å—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ –ª–∏–¥–µ—Ä–æ–≤ –∫–∞–∫ "${playerName}"`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
                loadLeaderboard();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º Rickroll –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                playRickroll();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞');
            } finally {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                saveScoreBtn.innerHTML = '<span>üíæ</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç';
                saveScoreBtn.disabled = false;
            }
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', (e) => {
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ–º —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ –Ω–∞ 180 –≥—Ä–∞–¥—É—Å–æ–≤
            switch(e.key) {
                case 'ArrowUp':
                    if (direction !== 'down') nextDirection = 'up';
                    e.preventDefault();
                    break;
                case 'ArrowDown':
                    if (direction !== 'up') nextDirection = 'down';
                    e.preventDefault();
                    break;
                case 'ArrowLeft':
                    if (direction !== 'right') nextDirection = 'left';
                    e.preventDefault();
                    break;
                case 'ArrowRight':
                    if (direction !== 'left') nextDirection = 'right';
                    e.preventDefault();
                    break;
                case ' ':
                    // –ü—Ä–æ–±–µ–ª –¥–ª—è –ø–∞—É–∑—ã/–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
                    togglePause();
                    e.preventDefault();
                    break;
            }
        });
        
        // –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        upBtn.addEventListener('click', () => { if (direction !== 'down') nextDirection = 'up'; });
        downBtn.addEventListener('click', () => { if (direction !== 'up') nextDirection = 'down'; });
        leftBtn.addEventListener('click', () => { if (direction !== 'right') nextDirection = 'left'; });
        rightBtn.addEventListener('click', () => { if (direction !== 'left') nextDirection = 'right'; });
        
        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–π
        function startGame() {
            if (!gameRunning) {
                initGame();
                gameRunning = true;
                gamePaused = false;
                gameInterval = setInterval(gameLoop, gameSpeed);
                startBtn.disabled = true;
                pauseBtn.textContent = '‚è∏ –ü–∞—É–∑–∞';
            }
        }
        
        function restartGame() {
            clearInterval(gameInterval);
            startGame();
        }
        
        function togglePause() {
            if (!gameRunning) return;
            
            gamePaused = !gamePaused;
            pauseBtn.textContent = gamePaused ? '‚ñ∂ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '‚è∏ –ü–∞—É–∑–∞';
            
            if (!gamePaused) {
                gameInterval = setInterval(gameLoop, gameSpeed);
            } else {
                clearInterval(gameInterval);
            }
        }
        
        function closeVideo() {
            videoWrapper.style.display = 'none';
            gameOverScreen.style.display = 'none';
        }
        
        // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', restartGame);
        pauseBtn.addEventListener('click', togglePause);
        leaderboardBtn.addEventListener('click', loadLeaderboard);
        closeVideoBtn.addEventListener('click', closeVideo);
        saveScoreBtn.addEventListener('click', saveGameResult);
        restartFromOverBtn.addEventListener('click', () => {
            closeVideo();
            restartGame();
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏–≥—Ä–æ–∫–∞ –∏–∑ localStorage
        window.addEventListener('load', () => {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ –∏–º—è –∏–≥—Ä–æ–∫–∞
            const savedName = localStorage.getItem('snakePlayerName');
            if (savedName) {
                playerNameInput.value = savedName;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
            playerNameInput.addEventListener('input', () => {
                localStorage.setItem('snakePlayerName', playerNameInput.value);
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
            initGame();
            drawGame();
            highScoreElement.textContent = highScore;
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            loadLeaderboard();
        });
    </script>
</body>
</html>
